function obsOcenka(){steps=perfect+cool+good+bad+miss;pointos=perfect*5+cool*4+good*3+bad*2+miss*1;srArefm=Math.round(pointos/steps);if(srArefm==5){Obshocenka="S"}else if(srArefm==4){Obshocenka="A"}else if(srArefm==3){Obshocenka="B"}else if(srArefm==2){Obshocenka="C"}else if(srArefm<=1){Obshocenka="D"}$(".Obshocenka").text(Obshocenka)}function results(){if(musica.ended){RecordsShow++;if(RecordsShow==1){setTimeout(function(){$("#p").text(perfect);$("#c").text(cool);$("#g").text(good);$("#b").text(bad);$("#m").text(miss);scoresPts=$("#pt").text();$("#pts").text(scoresPts);obsOcenka();$(".shared").html(VK.Share.button({url:"http://fandance.ru/music",title:"Dance Online - FanDance.Ru",description:"Я станцевал под песню "+$(".result > .artist").text()+" и набрал "+scoresPts+" очков!"},{type:"round",text:"Рассказать друзьям"}));res=$(".result");$(".dansez").html(res);res.slideDown(500)},sec+sec/2)}}}function proverkaFlasha(){if(navigator.plugins["Shockwave Flash"]){$(".control").html('<embed width="44px" height="18px" name="plugin" src="ClassicKey/Sprite/sprite332.swf" wmode="transparent" type="application/x-shockwave-flash">')}else{$(".control").css({background:"url(image/control.png)"})}}function points(e){pt=Number($("#pt").text());var t={perfect:200*(level/2),cool:100*(level/2),good:70*(level/2),bad:50*(level/2),miss:0};pt=pt+t[e];$("#pt").text(pt);return pt}function codeOcenka(ocenka){$(".ocenka").css({background:"url(image/"+ocenka+".png) center center no-repeat",visibility:"visible"});$(".music").html('<audio id="music" src="data:audio/ogg;base64,'+mus[ocenka]+' "controls style="visibility: hidden;" autoplay></audio>');ocenkos=ocenka+"++";eval(ocenkos);points(ocenka)}function TextToNum(e){var t=Number(e.replace("px",""));return t}function ocenkaHide(){setTimeout(function(){$(".ocenka").css({background:""})},sec+sec/2)}function buttons(e){var t=$(".panel>div.non:first").hasClass(e);if(t==true){$(".panel>div.non:first").removeClass("non").removeClass(e).addClass(e+"kl");$(".music").html(arr)}else if($(".panel>div").hasClass("non")==false){}else{$(".panel").html(pre)}}function spacer(){if(musica.ended==false&&musica.paused==false){$(".spacer").animate({left:"182px"},sec,"linear",function(){$(this).css({left:"0px"});if(status<=0){if(barSpace==0){codeOcenka("miss")}$(".panel").html("");status++}else{if(pre_level>2){if(level>9){level=1}else{level++}pre_level=1}$(".lvlnum").css({background:"url(image/"+level+".png) center center no-repeat"});arrow=0;getArrow(level,arrow);ocenkaHide();pre_level++;status--;barSpace=0}return arrow,level,status})}else{$(this).css({left:"0px"})}}function randomFromInterval(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function getArrow(e,t){$(".panel").html("");pre="";while(t!=e){generator=randomFromInterval(1,4);var n=["","right","up","left","down"];pre=pre+'<div class="'+n[generator]+" arrow"+generator+' non ar"></div>';t++}$(".panel").html(pre);return pre}function spacebar(){$(".panel>div").fadeOut();proverka_on_miss=$(".panel>div").hasClass("non");if(proverka_on_miss){codeOcenka("miss")}else{var e=TextToNum($(".spacer").css("left"));if(e>=143&&e<=145){codeOcenka("perfect")}else if(e>=141&&e<=143||e>145&&e<=147){codeOcenka("cool")}else if(e>=138&&e<=141||e>147&&e<=153){codeOcenka("good")}else if(e>=135&&e<=138||e>153&&e<=160){codeOcenka("bad")}else{codeOcenka("miss")}}}$("#music").attr({src:song});var level=0;var arrow=0;var status=1;var barSpace=0;var musica=document.getElementById("music");var sec=3e3-bpm*10;var pre_level=3;var perfect=0;var cool=0;var good=0;var bad=0;var miss=0;var RecordsShow=0;keypress.combo("up",function(){var e="up";buttons(e)});keypress.combo("down",function(){var e="down";buttons(e)});keypress.combo("left",function(){var e="left";buttons(e)});keypress.combo("right",function(){var e="right";buttons(e)});keypress.combo("space",function(){if(barSpace==0){spacebar();barSpace=1}return barSpace});keypress.combo("ctrl",function(){if(barSpace==0){spacebar();barSpace=1}return barSpace});setInterval(function(){$(".time").html(Math.floor(musica.currentTime/60)+":"+Math.floor(musica.currentTime%60)+"/"+Math.floor(musica.seekable.end(0)/60)+":"+Math.floor(musica.seekable.end(0)%60));$("#p").text(perfect);$("#c").text(cool);$("#g").text(good);$("#b").text(bad);$("#m").text(miss);results()},1);setInterval(function(){spacer()},sec);proverkaFlasha()